<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparador Seguros Auto MX</title>

<style>
body{
font-family:system-ui;
background:#0f172a;
color:#fff;
margin:0;
padding:0;
}
.container{
max-width:1000px;
margin:auto;
padding:20px;
}
.card{
background:#1e293b;
padding:25px;
border-radius:16px;
margin-bottom:20px;
}
input,select{
width:100%;
padding:12px;
margin:8px 0 15px 0;
border-radius:10px;
border:none;
}
button{
background:#2563eb;
border:none;
padding:14px;
color:#fff;
font-weight:bold;
border-radius:10px;
cursor:pointer;
width:100%;
}
button:hover{
background:#1d4ed8;
}
.results{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-top:20px;
}
.insurer{
background:#0f766e;
padding:20px;
border-radius:14px;
cursor:pointer;
transition:0.3s;
text-align:center;
}
.insurer:hover{
transform:scale(1.05);
}
.selected{
border:3px solid #22c55e;
}
@media(max-width:600px){
.container{padding:10px;}
}
</style>
</head>
<body>

<div class="container">

<h1>ðŸš— Comparador Inteligente de Seguros</h1>

<form name="cotizacion" method="POST" data-netlify="true">
<input type="hidden" name="form-name" value="cotizacion">

<div class="card">
<h3>Datos del conductor</h3>
<input type="text" name="nombre" placeholder="Nombre completo" required>
<input type="number" id="age" name="edad" placeholder="Edad" required>

<input type="text" id="make" placeholder="Marca (ej: nissan)" required>
<input type="number" id="year" placeholder="AÃ±o (ej: 2022)" required>

<select id="modelSelect" name="modelo" required>
<option value="">Selecciona modelo</option>
</select>

<button type="button" onclick="loadModels()">Buscar modelos</button>

<select id="coverage" name="cobertura">
<option value="basica">BÃ¡sica</option>
<option value="amplia">Amplia</option>
<option value="total">Total</option>
</select>

<button type="button" onclick="calculate()">Comparar aseguradoras</button>
</div>

<div id="results" class="results"></div>

<input type="hidden" name="aseguradora" id="insurerInput">
<input type="hidden" name="precio" id="priceInput">
<input type="hidden" name="estado_pago" value="pendiente">

<button type="submit" id="saveBtn" disabled>Guardar CotizaciÃ³n</button>

</form>

</div>

<script>

const insurers = {
AXA:{factor:1.0},
GNP:{factor:1.1},
HDI:{factor:0.95},
Chubb:{factor:1.2}
};

let selectedInsurer=null;

async function loadModels(){
const make=document.getElementById("make").value.toLowerCase();
const year=document.getElementById("year").value;

const res=await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/getmodelsformakeyear/make/${make}/modelyear/${year}?format=json`);
const data=await res.json();

const select=document.getElementById("modelSelect");
select.innerHTML='<option value="">Selecciona modelo</option>';

data.Results.slice(0,20).forEach(m=>{
const opt=document.createElement("option");
opt.value=m.Model_Name;
opt.textContent=m.Model_Name;
select.appendChild(opt);
});
}

function calculate(){

const age=parseInt(document.getElementById("age").value);
const coverage=document.getElementById("coverage").value;
const year=parseInt(document.getElementById("year").value);

let base=8000;

if(age<25) base*=1.3;
if(age>60) base*=1.4;
if(year<2015) base*=1.2;

if(coverage==="amplia") base*=1.2;
if(coverage==="total") base*=1.4;

const container=document.getElementById("results");
container.innerHTML="";

Object.keys(insurers).forEach(name=>{
let price=base*insurers[name].factor;

const div=document.createElement("div");
div.className="insurer";
div.innerHTML=`
<h3>${name}</h3>
<h2>$${price.toFixed(2)} MXN</h2>
<p>Pago pendiente</p>
<button onclick="selectInsurer('${name}',${price})">Seleccionar</button>
`;

container.appendChild(div);
});
}

function selectInsurer(name,price){

selectedInsurer=name;

document.getElementById("insurerInput").value=name;
document.getElementById("priceInput").value=price.toFixed(2);

document.getElementById("saveBtn").disabled=false;

alert("Seleccionaste "+name+" por $"+price.toFixed(2));
}

</script>

</body>
</html>
